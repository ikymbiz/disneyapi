<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disney Wait Times</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* 公式アプリを意識したカラーパレット */
            --disney-blue: #0064b7; /* メインの濃い青 */
            --bg-light: #f5f7fa;    /* 全体の背景色 */
            --text-dark: #2c3e50;   /* メインテキスト色 */
            --text-gray: #7f8c8d;   /* サブテキスト色 */
            --tdl-color: #e84393;   /* ランドのテーマカラー（上品なピンク） */
            --tds-color: #00a8ff;   /* シーのテーマカラー（さわやかな水色） */
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            margin: 0;
            background: var(--bg-light);
            color: var(--text-dark);
            -webkit-font-smoothing: antialiased; /* フォントを滑らかに */
        }

        .header {
            background: var(--disney-blue);
            color: white;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header h1 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
            letter-spacing: 1px;
        }

        /* コントロールエリア（ボタンなど） */
        .controls-container {
            background: white;
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            max-width: 600px;
            margin: 0 auto;
        }
        .btn {
            padding: 10px 24px;
            border: 1px solid #ddd;
            background: white;
            color: var(--text-gray);
            border-radius: 30px; /* 丸みを強く */
            cursor: pointer;
            font-weight: 700;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            flex: 1; /* ボタンの幅を均等に */
            max-width: 120px;
            text-align: center;
        }
        /* アクティブ時のスタイル */
        .btn-park.active[data-park="TDL"] { background: var(--tdl-color); color: white; border-color: var(--tdl-color); box-shadow: 0 4px 10px rgba(232, 67, 147, 0.3); }
        .btn-park.active[data-park="TDS"] { background: var(--tds-color); color: white; border-color: var(--tds-color); box-shadow: 0 4px 10px rgba(0, 168, 255, 0.3); }
        .btn-lang {
            flex: 0 0 auto; /* 言語切替ボタンは幅を固定 */
            background: #f0f0f0;
            color: var(--text-dark);
        }

        .info-bar {
            text-align: center;
            font-size: 0.75rem;
            color: var(--text-gray);
            padding: 10px 0;
        }

        /* メインコンテンツエリア */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 15px 30px;
        }
        .grid {
            display: grid;
            gap: 12px;
        }

        /* アトラクションカードのデザイン */
        .card {
            background: white;
            padding: 18px 20px;
            border-radius: 16px; /* 大きな角丸 */
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); /* 柔らかい影 */
            border: 1px solid rgba(0,0,0,0.03);
            transition: transform 0.2s;
        }
        .card:active {
            transform: scale(0.98); /* タップ時のエフェクト */
        }
        
        .ride-name {
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 4px;
            line-height: 1.4;
        }
        .park-label {
            font-size: 0.65rem;
            color: var(--text-gray);
            display: flex;
            align-items: center;
        }
        .park-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .dot-tdl { background: var(--tdl-color); }
        .dot-tds { background: var(--tds-color); }

        /* 待ち時間表示のデザイン */
        .wait-time-box {
            text-align: right;
            min-width: 80px;
        }
        .wait-time {
            font-size: 2rem; /* 数字を大きく */
            font-weight: 900;
            color: var(--disney-blue); /* 青色で強調 */
            line-height: 1;
        }
        .unit {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--disney-blue);
            margin-left: 2px;
        }
        .closed-status {
            color: #bdc3c7;
            font-weight: 700;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }
    </style>
</head>
<body>

<div class="header">
    <h1>TOKYO DISNEY RESORT</h1>
</div>

<div class="controls-container">
    <div class="controls">
        <button class="btn btn-park active" data-park="TDL">ランド</button>
        <button class="btn btn-park" data-park="TDS">シー</button>
        <button class="btn btn-lang" id="toggle-lang">日/英</button>
    </div>
    <div class="info-bar">
        <span id="last-updated">データを読み込んでいます...</span>
    </div>
</div>

<div class="container">
    <div id="output" class="grid"></div>
</div>

<script>
    let currentPark = "TDL";
    let currentLang = "ja";
    let allRides = [];

    const output = document.getElementById('output');
    const lastUpdated = document.getElementById('last-updated');

    async function loadData() {
        try {
            // キャッシュを回避して最新のdata.jsonを取得
            const res = await fetch('./data.json?t=' + Date.now());
            if (!res.ok) throw new Error("Data not found");
            const data = await res.json();
            allRides = data.rides;
            
            const updateTime = new Date(data.updated_at);
            lastUpdated.innerText = `最終更新: ${updateTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
            render();
        } catch (e) {
            output.innerHTML = `
                <div style="text-align:center; padding: 40px; color: #999;">
                    <p>データ取得中、またはエラーが発生しました。</p>
                    <p style="font-size:0.8rem;">GitHub Actionsの初回実行を待っている可能性があります。</p>
                </div>`;
            lastUpdated.innerText = "---";
        }
    }

    function render() {
        const filtered = allRides.filter(r => r.park === currentPark);
        
        // ソート: 運営中を優先し、その中で待ち時間の長い順
        filtered.sort((a, b) => {
            if (a.is_open !== b.is_open) return b.is_open ? 1 : -1;
            return b.wait_time - a.wait_time;
        });

        output.innerHTML = filtered.map(ride => {
            const name = currentLang === 'ja' ? ride.name_ja : ride.name_en;
            const parkLabel = ride.park === 'TDL' ? '東京ディズニーランド' : '東京ディズニーシー';
            const dotClass = ride.park === 'TDL' ? 'dot-tdl' : 'dot-tds';

            // ★★★ ここがロジック変更のポイント ★★★
            // 開園中(is_open)かつ、待ち時間が60分以上なら 0分 と表示する
            let waitDisplay;
            if (ride.is_open) {
                const displayTime = ride.wait_time >= 60 ? 0 : ride.wait_time;
                waitDisplay = `
                    <span class="wait-time">${displayTime}</span>
                    <span class="unit">分</span>`;
            } else {
                waitDisplay = `<span class="closed-status">CLOSE</span>`;
            }

            return `
                <div class="card">
                    <div>
                        <div class="ride-name">${name}</div>
                        <div class="park-label">
                            <span class="park-dot ${dotClass}"></span>${parkLabel}
                        </div>
                    </div>
                    <div class="wait-time-box">
                        ${waitDisplay}
                    </div>
                </div>
            `;
        }).join('');
    }

    // イベントリスナー設定
    document.querySelectorAll('.btn-park').forEach(btn => {
        btn.addEventListener('click', (e) => {
            document.querySelectorAll('.btn-park').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            currentPark = e.target.dataset.park;
            render();
        });
    });

    document.getElementById('toggle-lang').addEventListener('click', () => {
        currentLang = currentLang === 'ja' ? 'en' : 'ja';
        render();
    });

    // 初回ロードと定期更新（1分おきに画面だけリフレッシュ）
    loadData();
    setInterval(loadData, 60000);
</script>
</body>
</html>
