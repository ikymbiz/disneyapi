<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TDS 待ち時間一覧 (日本語版)</title>
    <style>
        body { font-family: "Helvetica Neue", Arial, sans-serif; margin: 0; background: #eef2f7; color: #333; }
        .header { background: #004488; color: white; padding: 20px; text-align: center; position: sticky; top: 0; z-index: 10; }
        .container { max-width: 600px; margin: 20px auto; padding: 0 15px; }
        .info-bar { background: #fff; padding: 10px; border-radius: 8px; margin-bottom: 15px; display: flex; justify-content: space-between; font-size: 13px; color: #666; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .ride-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #f0f0f0; transition: background 0.2s; }
        .ride-item:last-child { border-bottom: none; }
        .ride-item:hover { background: #f9fbff; }
        .name-container { flex: 1; padding-right: 10px; }
        .ride-name-ja { font-weight: bold; font-size: 16px; display: block; margin-bottom: 2px; }
        .ride-name-en { font-size: 11px; color: #999; }
        .wait-time-box { text-align: right; min-width: 80px; }
        .time-value { font-size: 20px; font-weight: 900; color: #e67e22; }
        .time-unit { font-size: 12px; color: #e67e22; margin-left: 2px; }
        .status-closed { color: #95a5a6; font-weight: bold; }
        .loading { text-align: center; padding: 40px; color: #666; }
    </style>
</head>
<body>

    <div class="header">
        <h1 style="margin:0; font-size: 20px;">東京ディズニーシー 待ち時間</h1>
    </div>

    <div class="container">
        <div class="info-bar">
            <span id="update-time">読み込み中...</span>
            <span id="count-display">-- 件の施設</span>
        </div>

        <div id="output" class="card">
            <p class="loading">最新のデータを取得しています...</p>
        </div>
    </div>

<script>
// --- 名前変換辞書 (主要なもの) ---
const nameMap = {
    "Soaring: Fantastic Flight": "ソアリン：ファンタスティック・フライト",
    "Toy Story Mania!": "トイ・ストーリー・マニア！",
    "Tower of Terror": "タワー・オブ・テラー",
    "Journey to the Center of the Earth": "センター・オブ・ジ・アース",
    "Indiana Jones® Adventure: Temple of the Crystal Skull": "インディ・ジョーンズ®：クリスタルスカルの魔宮",
    "Raging Spirits": "レイジングスピリッツ",
    "20,000 Leagues Under the Sea": "海底2万マイル",
    "Turtle Talk": "タートル・トーク",
    "Nemo & Friends SeaRider": "ニモ＆フレンズ・シーライダー",
    "Aquatopia": "アクアトピア",
    "The Magic Lamp Theater": "マジックランプシアター",
    "Sindbad's Storybook Voyage": "シンドバッド・ストーリーブック・ヴォヤッジ",
    "Jasmine's Flying Carpets": "ジャスミンのフライングカーペット",
    "Flounder's Flying Fish Coaster": "フランダーのフライングフィッシュコースター",
    "Scuttle's Scooters": "スカットルのスクーター",
    "Jumpin' Jellyfish": "ジャンピン・ジェリーフィッシュ",
    "Blowfish Balloon Race": "ブローフィッシュ・バルーンレース",
    "Venetian Gondolas": "ヴェネツィアン・ゴンドラ",
    "DisneySea Electric Railway": "ディズニーシー・エレクトリックレールウェイ",
    "DisneySea Transit Steamer Line": "ディズニーシー・トランジットスチーマーライン",
    "Anna and Elsa's Frozen Journey": "アナとエルサのフローズンジャーニー",
    "Peter Pan's Never Land Adventure": "ピーターパンのネバーランドアドベンチャー",
    "Fairy Tinker Bell's Busy Buggies": "フェアリー・ティンカーベルのビジーバギー",
    "Rapunzel's Lantern Festival": "ラプンツェルのランタンフェスティバル",
    "Mickey & Friends Greeting Trails": "ミッキー＆フレンズ・グリーティングトレイル"
};

async function fetchWaitTimes() {
    const targetUrl = "https://queue-times.com/parks/275/queue_times.json";
    const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(targetUrl)}`;

    try {
        const response = await fetch(proxyUrl);
        const rawData = await response.json();
        const data = JSON.parse(rawData.contents);
        
        let allRides = [];
        data.lands.forEach(land => {
            allRides = allRides.concat(land.rides);
        });

        // 待ち時間順にソート
        allRides.sort((a, b) => b.wait_time - a.wait_time);

        let htmlContent = "";
        allRides.forEach(ride => {
            const nameJa = nameMap[ride.name] || ride.name; // 辞書になければ英語名
            const waitDisplay = ride.is_open 
                ? `<span class="time-value">${ride.wait_time}</span><span class="time-unit">分</span>` 
                : `<span class="status-closed">休止中</span>`;

            htmlContent += `
                <div class="ride-item">
                    <div class="name-container">
                        <span class="ride-name-ja">${nameJa}</span>
                        <span class="ride-name-en">${ride.name}</span>
                    </div>
                    <div class="wait-time-box">${waitDisplay}</div>
                </div>
            `;
        });

        document.getElementById('output').innerHTML = htmlContent;
        document.getElementById('count-display').innerText = `${allRides.length} 件の施設を表示中`;
        document.getElementById('update-time').innerText = `更新: ${new Date().toLocaleTimeString()}`;

    } catch (error) {
        document.getElementById('output').innerHTML = "<p style='padding:20px;'>取得エラーが発生しました。</p>";
        console.error(error);
    }
}

fetchWaitTimes();
// 3分ごとに自動更新
setInterval(fetchWaitTimes, 180000);
</script>
</body>
</html>
