<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Disney API Debugger</title>
    <style>
        :root { --tdl-color: #ed1651; --tds-color: #004488; }
        body { font-family: sans-serif; margin: 0; background: #f4f7f9; color: #333; }
        .header { background: #333; color: white; padding: 1rem; text-align: center; }
        .controls { display: flex; justify-content: center; gap: 10px; padding: 20px; flex-wrap: wrap; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn { padding: 10px 20px; border: none; border-radius: 20px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-park { background: #eee; color: #666; }
        .btn-park.active[data-park="TDL"] { background: var(--tdl-color); color: white; }
        .btn-park.active[data-park="TDS"] { background: var(--tds-color); color: white; }
        .btn-lang { background: #666; color: white; }
        .info { text-align: center; font-size: 0.8rem; color: #888; margin: 10px 0; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .grid { display: grid; gap: 10px; }
        .card { background: white; padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .wait-time { font-size: 1.5rem; font-weight: 900; color: #e67e22; }
        .unit { font-size: 0.8rem; margin-left: 3px; }
        .closed { color: #ccc; font-weight: bold; }
        .park-tag { font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; margin-bottom: 5px; display: inline-block; color: white; }
        .tag-tdl { background: var(--tdl-color); }
        .tag-tds { background: var(--tds-color); }
    </style>
</head>
<body>

<div class="header">
    <h1>Disney Parks API Checker</h1>
</div>

<div class="controls">
    <button class="btn btn-park active" data-park="TDL">LAND</button>
    <button class="btn btn-park" data-park="TDS">SEA</button>
    <button class="btn btn-lang" id="toggle-lang">English / 日本語</button>
</div>

<div class="info">
    <span id="last-updated">Loading...</span>
</div>

<div class="container">
    <div id="output" class="grid"></div>
</div>

<script>
    let currentPark = "TDL";
    let currentLang = "ja"; // 'ja' or 'en'
    let allRides = [];

    const output = document.getElementById('output');
    const lastUpdated = document.getElementById('last-updated');

    // データ取得
    async function loadData() {
        try {
            const res = await fetch('./data.json?t=' + Date.now()); // キャッシュ回避
            const data = await res.json();
            allRides = data.rides;
            lastUpdated.innerText = `最終更新: ${new Date(data.updated_at).toLocaleString()}`;
            render();
        } catch (e) {
            output.innerHTML = "<p>データが見つかりません。GitHub Actionsが完了するまでお待ちください。</p>";
        }
    }

    function render() {
        const filtered = allRides.filter(r => r.park === currentPark);
        // 待ち時間順にソート
        filtered.sort((a, b) => b.wait_time - a.wait_time);

        output.innerHTML = filtered.map(ride => `
            <div class="card">
                <div>
                    <span class="park-tag ${ride.park === 'TDL' ? 'tag-tdl' : 'tag-tds'}">${ride.park}</span>
                    <div style="font-weight:bold">${currentLang === 'ja' ? ride.name_ja : ride.name_en}</div>
                </div>
                <div class="wait-time">
                    ${ride.is_open ? `${ride.wait_time}<span class="unit">min</span>` : '<span class="closed">Closed</span>'}
                </div>
            </div>
        `).join('');
    }

    // イベントリスナー
    document.querySelectorAll('.btn-park').forEach(btn => {
        btn.addEventListener('click', (e) => {
            document.querySelectorAll('.btn-park').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            currentPark = e.target.dataset.park;
            render();
        });
    });

    document.getElementById('toggle-lang').addEventListener('click', () => {
        currentLang = currentLang === 'ja' ? 'en' : 'ja';
        render();
    });

    loadData();
</script>
</body>
</html>
